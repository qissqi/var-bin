#include<stdio.h>
#include<stdlib.h>
#include<windows.h>
#include"DX_TIMER.h"



int state[] = { 0,31,32,33 };
int vKey[255] = { 0b000 };
void printKey(void)
{
#define _k(A)		"│ \033[%dm" A "\033[0m"
#define _g(A)		"┤ \033[%dm" A "\033[0m"
#define k(A)		"│\033[%dm" A "\033[0m"
#define s(v)		state[vKey[v]]
	printf("\033[2;H"
		"┌───┐   ┌───┬───┬───┬───┐ ┌───┬───┬───┬───┐ ┌───┬───┬───┬───┐ ┌───┬───┬───┐\n"
		k("Esc")"│   " _k("F1")_k("F2")_k("F3")_k("F4")"│ " _k("F5")_k("F6")_k("F7")_k("F8")"│ " _k("F9")k("F10")k("F11")k("F12")"│ " k("P/S")k("S L")k("P/B")"│\n"
		"└───┘   └───┴───┴───┴───┘ └───┴───┴───┴───┘ └───┴───┴───┴───┘ └───┴───┴───┘\n"
		"┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───────┐ ┌───┬───┬───┐ ┌───┬───┬───┬───┐\n"
		_k("~`")_k("!1")_k("@2")_k("#3")_k("$4")_k("%%5")_k("^6")_k("&7")_k("*8")_k("(9")_k(")0")_k("_-")_k("+=")_k("BacSp ")"│ " k("Ins")k("Hom")k("PUp")"│ " k("N L")_k("/ ")_k("* ")_k("- ")"│\n"
		"├───┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─────┤ ├───┼───┼───┤ ├───┼───┼───┼───┤\n"
		_k("Tab ")_k("Q ")_k("W ")_k("E ")_k("R ")_k("T ")_k("Y ")_k("U ")_k("I ")_k("O ")_k("P ")_k("{[")_k("}]")_k("|\\  ")"│ " k("Del")k("End")k("PDn")"│ " _k("7 ")_k("8 ")_k("9 ")"│   │\n"
		"├─────┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴─────┤ └───┴───┴───┘ ├───┼───┼───" _g("+ ") "│\n"
		_k("Caps ")_k("A ")_k("S ")_k("D ")_k("F ")_k("G ")_k("H ")_k("J ")_k("K ")_k("L ")_k(":;")_k("\"\'")_k("Enter  ")"│               " _k("4 ")_k("5 ")_k("6 ")"│   │\n"
		"├──────┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴────────┤     ┌───┐     ├───┼───┼───┼───┤\n"
		_k("Shift  ")_k("Z ")_k("X ")_k("C ")_k("V ")_k("B ")_k("N ")_k("M ")_k("<,")_k(">.")_k("?/")_k(" Shift   ")"│     " _k("↑")"│     " _k("1 ")_k("2 ")_k("3 ")"│   │\n"
		"├─────┬──┴─┬─┴──┬┴───┴───┴───┴───┴───┴──┬┴───┼───┴┬────┬────┤ ┌───┼───┼───┐ ├───┴───┼───" _g("E│")"│\n"
		_k("Ctrl")"│    " _k("Alt")_k("         Space        ")"│    " _k("Alt")"│    " k("Ctrl")"│ " _k("←")_k("↓")_k("→")"│ " _k("  0   ")_k(". ")_k("<┘")"│\n"
		"└─────┴────┴────┴───────────────────────┴────┴────┴────┴────┘ └───┴───┴───┘ └───────┴───┴───┘\n"
		,s(VK_ESCAPE), s(VK_F1), s(VK_F2), s(VK_F3), s(VK_F4), s(VK_F5), s(VK_F6), s(VK_F7), s(VK_F8), s(VK_F9), s(VK_F10), s(VK_F11), s(VK_F12), s(0), s(0), s(0),
		s(VK_OEM_3), s('1'), s('2'), s('3'), s('4'), s('5'), s('6'), s('7'), s('8'), s('9'), s('0'), s(VK_OEM_MINUS), s(VK_OEM_PLUS), s(VK_BACK), s(0), s(0), s(0), s(VK_NUMLOCK), s(VK_DIVIDE), s(VK_MULTIPLY), s(VK_SUBTRACT), 
		s(VK_TAB), s('Q'), s('W'), s('E'), s('R'), s('T'), s('Y'), s('U'), s('I'), s('O'), s('P'), s(VK_OEM_4), s(VK_OEM_6), s(VK_OEM_5), s(0), s(0), s(0), s(VK_NUMPAD7), s(VK_NUMPAD8), s(VK_NUMPAD9),
		s(VK_ADD),
		s(VK_CAPITAL), s('A'), s('S'), s('D'), s('F'), s('G'), s('H'), s('J'), s('K'), s('L'), s(VK_OEM_1), s(VK_OEM_7), s(VK_RETURN), s(VK_NUMPAD4), s(VK_NUMPAD5), s(VK_NUMPAD6),
		s(VK_LSHIFT), s('Z'), s('X'), s('C'), s('V'), s('B'), s('N'), s('M'), s(VK_OEM_COMMA), s(VK_OEM_PERIOD), s(VK_OEM_2), s(VK_RSHIFT), s(VK_UP), s(VK_NUMPAD1), s(VK_NUMPAD2), s(VK_NUMPAD3),
		s(VK_SEPARATOR),
		s(VK_CONTROL), s(VK_MENU), s(VK_SPACE), s(VK_MENU), s(VK_CONTROL), s(VK_LEFT), s(VK_DOWN), s(VK_RIGHT), s(VK_NUMPAD0), s(VK_DECIMAL)
	);
	/***
	 * ┌───┐   ┌───┬───┬───┬───┐ ┌───┬───┬───┬───┐ ┌───┬───┬───┬───┐ ┌───┬───┬───┐
	 * │Esc│   │ F1│ F2│ F3│ F4│ │ F5│ F6│ F7│ F8│ │ F9│F10│F11│F12│ │P/S│S L│P/B│  ┌┐    ┌┐    ┌┐
	 * └───┘   └───┴───┴───┴───┘ └───┴───┴───┴───┘ └───┴───┴───┴───┘ └───┴───┴───┘  └┘    └┘    └┘
	 * ┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───────┐ ┌───┬───┬───┐ ┌───┬───┬───┬───┐
	 * │~ `│! 1│@ 2│# 3│$ 4│% 5│^ 6│& 7│* 8│( 9│) 0│_ -│+ =│ BacSp │ │Ins│Hom│PUp│ │N L│ / │ * │ - │
	 * ├───┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─────┤ ├───┼───┼───┤ ├───┼───┼───┼───┤
	 * │ Tab │ Q │ W │ E │ R │ T │ Y │ U │ I │ O │ P │{ [│} ]│ | \ │ │Del│End│PDn│ │ 7 │ 8 │ 9 │   │
	 * ├─────┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴┬──┴─────┤ └───┴───┴───┘ ├───┼───┼───┤ + │
	 * │ Caps │ A │ S │ D │ F │ G │ H │ J │ K │ L │: ;│" '│ Enter  │               │ 4 │ 5 │ 6 │   │
	 * ├──────┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴────────┤     ┌───┐     ├───┼───┼───┼───┤
	 * │ Shift  │ Z │ X │ C │ V │ B │ N │ M │< ,│> .│? /│  Shift   │     │ ↑ │     │ 1 │ 2 │ 3 │   │
	 * ├─────┬──┴─┬─┴──┬┴───┴───┴───┴───┴───┴──┬┴───┼───┴┬────┬────┤ ┌───┼───┼───┐ ├───┴───┼───┤ E││
	 * │ Ctrl│    │Alt │         Space         │    │Alt │    │Ctrl│ │ ← │ ↓ │ → │ │   0   │ . │ <┘│
	 * └─────┴────┴────┴───────────────────────┴────┴────┴────┴────┘ └───┴───┴───┘ └───────┴───┴───┘
	 */
}

int main(void)
{
	system("cls");
	printf("\033[0m[松开] \033[31m[按下] \033[33m[按住] \033[32m[弹起]");
	int i = 0;
	TIMER t(16);
	int x = 0;
	for (;;)
	{
		for (i = 1; i < 255; i++)
		{
			vKey[i] = (vKey[i] << 1) & 0b010;
			if (vKey[i] == 0b011)
			{
				x++;
			}
		}

		for (;!t.isTimeCountEnd();)
		{
			for (i = 0; i < 255; i++)
			{
				vKey[i] |= (GetAsyncKeyState(i)) ? 0b001 : 0b000;
			}
		}
		t.ReTiming();

		printKey();
	}
	return 0;
}

int pr(const char* format, ...)
{

}

